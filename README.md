# FX-DB-UPDATER

Cloud –ø–∞—Ä—Å–µ—Ä –¥–ª—è Telegram-–∫–∞–Ω–∞–ª—ñ–≤ –≤–∞–ª—é—Ç–Ω–∏—Ö –∫—É—Ä—Å—ñ–≤.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
FX-DB-UPDATER/
‚îú‚îÄ‚îÄ supabase_io.py              # –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –º–æ–¥—É–ª—å –¥–ª—è Supabase
‚îú‚îÄ‚îÄ fx_parse_SWAPS_auto.py      # –ü–∞—Ä—Å–µ—Ä –¥–ª—è –∫–∞–Ω–∞–ª—É SWAPS
‚îú‚îÄ‚îÄ requirements.txt            # –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îú‚îÄ‚îÄ FIX_SUPABASE.md            # ‚ö†Ô∏è –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ë–î
‚îú‚îÄ‚îÄ fix_supabase_constraint.sql # SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è constraint
‚îî‚îÄ‚îÄ .env                        # –ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è (–Ω–µ –≤ Git!)
```

## üöÄ –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏

### 1. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Supabase

–°—Ç–≤–æ—Ä–∏ `.env` —Ñ–∞–π–ª:

```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your_service_role_key
```

### 2. –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
python fx_parse_SWAPS_auto.py
```

### 3. –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –Ω–∞ Render

**–í–∞—Ä—ñ–∞–Ω—Ç A: Cron Job (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)**

1. –í—ñ–¥–∫—Ä–∏–π https://dashboard.render.com
2. –ù–∞—Ç–∏—Å–Ω–∏ "New +" ‚Üí **"Cron Job"**
3. –ü—ñ–¥–∫–ª—é—á–∏ GitHub —Ä–µ–ø–æ: **kulishdenis-Tech/FX-DB-UPDATER**
4. –ù–∞–ª–∞—à—Ç—É–π:
   - **Name**: `fx-parser-swaps`
   - **Schedule**: `*/10 * * * *` (–∫–æ–∂–Ω—ñ 10 —Ö–≤–∏–ª–∏–Ω)
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python fx_parse_SWAPS_auto.py`
5. –î–æ–¥–∞–π Environment Variables (Supabase Dashboard ‚Üí Settings ‚Üí API):
   - `SUPABASE_URL` = `https://xxxxx.supabase.co`
   - `SUPABASE_KEY` = `service_role_key` (–Ω–µ anon key!)
6. –ù–∞—Ç–∏—Å–Ω–∏ "Create Cron Job"

**‚ö†Ô∏è –£–≤–∞–≥–∞:** –Ø–∫—â–æ —É —Ç–µ–±–µ –≤–∂–µ —î Background Worker **FX-DB-UPDATER**, –≤–∏–¥–∞–ª–∏ –π–æ–≥–æ –ø–µ—Ä–µ–¥ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º Cron Job!

## üß† –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏ –ø–∞—Ä—Å–µ—Ä–∞

–ü–∞—Ä—Å–µ—Ä –ø—Ä–∞—Ü—é—î –∑ **anti-duplicate** –ª–æ–≥—ñ–∫–æ—é:
- ‚úÖ –ü–∞—Ä—Å–∏—Ç—å **–≤—Å—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** –∑ RAW —Ñ–∞–π–ª—É
- ‚úÖ –ü–æ—Ä—ñ–≤–Ω—é—î –∫—É—Ä—Å–∏ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º–∏ –≤ –ë–î
- ‚úÖ **–ó–∞–ø–∏—Å—É—î —Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ –∞–±–æ –∑–º—ñ–Ω–µ–Ω—ñ –∫—É—Ä—Å–∏**
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞—î –¥—É–±–ª—ñ–∫–∞—Ç–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: PLN –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è 11.40/11.60 –ø—Ä–æ—Ç—è–≥–æ–º –∫—ñ–ª—å–∫–æ—Ö –¥–Ω—ñ–≤)

**–ü—Ä–∏–∫–ª–∞–¥:** –Ø–∫—â–æ –≤ RAW —î 330 –∫—É—Ä—Å—ñ–≤, –∞–ª–µ –ë–î –≤–∂–µ –º—ñ—Å—Ç–∏—Ç—å 238 –±–µ–∑ –∑–º—ñ–Ω, –ø–∞—Ä—Å–µ—Ä –¥–æ–¥–∞—Å—Ç—å —Ç—ñ–ª—å–∫–∏ **92 –Ω–æ–≤–∏—Ö**.

## üìä –©–æ —Ä–æ–±–∏—Ç—å –ø–∞—Ä—Å–µ—Ä

1. ‚úÖ –ß–∏—Ç–∞—î RAW –¥–∞–Ω—ñ –∑ Supabase Storage (`SWAPS_raw.txt`)
2. ‚úÖ –ü–∞—Ä—Å–∏—Ç—å –∫—É—Ä—Å–∏ –≤–∞–ª—é—Ç (USD, EUR, PLN —Ç–æ—â–æ)
3. ‚úÖ –í–∏—Ç—è–≥—É—î –º–µ—Ç–∞–¥–∞–Ω—ñ (message_id, version, published, edited)
4. ‚úÖ –§—ñ–ª—å—Ç—Ä—É—î –¥—É–±–ª—ñ–∫–∞—Ç–∏
5. ‚úÖ –ó–∞–ø–∏—Å—É—î –Ω–æ–≤—ñ –∫—É—Ä—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—é `rates` —É Supabase

## üîß –†–æ–∑—Ä–æ–±–∫–∞

–ü–∞—Ä—Å–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **—Ç—ñ —Å–∞–º—ñ —Ä–µ–≥—É–ª—è—Ä–∫–∏** —â–æ –π –ª–æ–∫–∞–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è, –∞–ª–µ:
- –ß–∏—Ç–∞—î –∑ **Supabase Storage** –∑–∞–º—ñ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤
- –ó–∞–ø–∏—Å—É—î —Ç—ñ–ª—å–∫–∏ –≤ **Supabase DB** (–±–µ–∑ CSV)
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –¥—É–±–ª—ñ–∫–∞—Ç–∏ —á–µ—Ä–µ–∑ **–ë–î –∑–∞–ø–∏—Ç**

## üìù –õ–æ–≥–∏

```
[CLOUD] ‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ Supabase
[CLOUD] ‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ 54234 —Å–∏–º–≤–æ–ª—ñ–≤ –∑ Supabase
[CLOUD] –û—Å—Ç–∞–Ω–Ω—ñ –∫—É—Ä—Å–∏ –≤ –ë–î: 15 –ø–∞—Ä
[PARSED] –ó–Ω–∞–π–¥–µ–Ω–æ: 20 | –ù–æ–≤–∏—Ö: 5 | –ü—Ä–æ–ø—É—â–µ–Ω–æ: 15
  ‚Üí UAH –ø–∞—Ä: 3 | –ö—Ä–æ—Å-–∫—É—Ä—Å—ñ–≤: 2
[CLOUD] üåê SWAPS: –¥–æ–¥–∞–Ω–æ 5, –ø—Ä–æ–ø—É—â–µ–Ω–æ 15
[DONE] ‚úÖ –ì–æ—Ç–æ–≤–æ.
```

